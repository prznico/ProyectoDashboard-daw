<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - ResourceHub</title>
    <link rel="stylesheet" href="https://bootswatch.com/4/superhero/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <style>
      .register-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #375a7f 0%, #1e3a5f 100%);
        padding: 2rem 0;
      }
      .register-card {
        width: 100%;
        max-width: 450px;
        padding: 2rem;
        background-color: #323232;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      }
      .register-header {
        text-align: center;
        margin-bottom: 2rem;
      }
      .register-header h1 {
        font-size: 2rem;
        color: #5a8cc8;
        margin-bottom: 0.5rem;
      }
      .register-header p {
        color: #adb5bd;
        font-size: 0.95rem;
      }
      .form-group label {
        color: #fff;
        font-weight: 500;
      }
      .form-control {
        background-color: #3a3a3a;
        border: 1px solid #495057;
        color: #fff;
      }
      .form-control:focus {
        background-color: #3a3a3a;
        color: #fff;
        border-color: #5a8cc8;
        box-shadow: 0 0 0 0.2rem rgba(90, 140, 200, 0.25);
      }
      .btn-register {
        background-color: #28a745;
        border: none;
        color: #fff;
        font-weight: 600;
        padding: 0.75rem;
        transition: all 0.3s ease;
      }
      .btn-register:hover {
        background-color: #218838;
        color: #fff;
      }
      .register-footer {
        text-align: center;
        margin-top: 1.5rem;
        color: #adb5bd;
      }
      .register-footer a {
        color: #5a8cc8;
        text-decoration: none;
      }
      .register-footer a:hover {
        text-decoration: underline;
      }
      .error-message {
        color: #ff6b6b;
        font-size: 0.9rem;
        margin-top: 0.5rem;
        display: none;
      }
      .success-message {
        color: #90ee90;
        font-size: 0.9rem;
        margin-top: 0.5rem;
        display: none;
      }
      .form-text {
        color: #adb5bd !important;
      }
      .password-strength {
        height: 5px;
        margin-top: 0.5rem;
        border-radius: 3px;
        background-color: #495057;
      }
      .strength-weak {
        background-color: #dc3545;
      }
      .strength-medium {
        background-color: #ffc107;
      }
      .strength-strong {
        background-color: #28a745;
      }
    </style>
</head>
<body>

    <div class="register-container">
      <div class="register-card">
        <div class="register-header">
          <h1>Crea tu Usuario</h1>
          <p>Crea tu cuenta en ResourceHub</p>
        </div>

        <form id="register-form" onsubmit="submitRegister(event)">
          <div class="form-group">
            <label for="nombre">Nombre Completo</label>
            <input class="form-control" type="text" id="nombre" name="nombre"  required>
            <small class="form-text">Mínimo 3 caracteres</small>
          </div>

          <div class="form-group">
            <label for="email">Correo Electrónico</label>
            <input class="form-control" type="email" id="email" name="email" placeholder="tu@email.com" required>
            <small class="form-text">Usarás este correo para iniciar sesión</small>
          </div>

          <div class="form-group">
            <label for="rol">Tipo de usuario</label>
            <select class="form-control" id="rol" name="rol" required>
                <option value="visitante">Visitante</option>
                <option value="admin">Administrador</option>
            </select>
          </div>


          <div class="form-group">
            <label for="password">Contraseña</label>
            <input class="form-control" type="password" id="password" name="password" placeholder="••••••••" required minlength="6">
            <div class="password-strength" id="strength"></div>
            <small class="form-text">Mínimo 6 caracteres. Usa mayúsculas, números y símbolos para mayor seguridad</small>
          </div>

          <div class="form-group">
            <label for="password_confirm">Confirmar Contraseña</label>
            <input class="form-control" type="password" id="password_confirm" name="password_confirm" placeholder="••••••••" required>
            <div id="password-match-message" style="color: #adb5bd; font-size: 0.9rem; margin-top: 0.5rem;"></div>
          </div>

          <button class="btn btn-register btn-block" type="submit" id="submit-btn">Crear Cuenta</button>

          <div id="message" class="error-message"></div>
        </form>

        <div class="register-footer">
          <p>¿Ya tienes cuenta? <a href="login.html">Inicia sesión aquí</a></p>
          <p><a href="catalogo.html">Continuar como visitante →</a></p>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>
      // VERIFICAR FORTALEZA DE CONTRASEÑA
      $('#password').on('keyup', function() {
        const password = $(this).val();
        const strength = document.getElementById('strength');
        let level = 0;

        if (password.length >= 6) level++;
        if (/[a-z]/.test(password)) level++;
        if (/[A-Z]/.test(password)) level++;
        if (/[0-9]/.test(password)) level++;
        if (/[^a-zA-Z0-9]/.test(password)) level++;

        strength.className = 'password-strength';
        if (level < 2) {
          strength.classList.add('strength-weak');
        } else if (level < 4) {
          strength.classList.add('strength-medium');
        } else {
          strength.classList.add('strength-strong');
        }
      });

      // VERIFICAR COINCIDENCIA DE CONTRASEÑAS
      $('#password, #password_confirm').on('keyup', function() {
        const password = $('#password').val();
        const confirm = $('#password_confirm').val();
        const message = $('#password-match-message');

        if (confirm === '') {
          message.text('');
          return;
        }

        if (password === confirm) {
          message.text('✓ Las contraseñas coinciden').css('color', '#90ee90');
        } else {
          message.text('✕ Las contraseñas no coinciden').css('color', '#ff6b6b');
        }
      });

      // ENVIAR FORMULARIO
      function submitRegister(event) {
        event.preventDefault();

        const nombre = $('#nombre').val();
        const email = $('#email').val();
        const password = $('#password').val();
        const passwordConfirm = $('#password_confirm').val();
        const messageEl = $('#message');

        // Validaciones
        if (nombre.length < 3) {
          messageEl.removeClass('success-message').addClass('error-message');
          messageEl.text('✕ El nombre debe tener al menos 3 caracteres').show();
          return;
        }

        if (password.length < 6) {
          messageEl.removeClass('success-message').addClass('error-message');
          messageEl.text('✕ La contraseña debe tener al menos 6 caracteres').show();
          return;
        }

        if (password !== passwordConfirm) {
          messageEl.removeClass('success-message').addClass('error-message');
          messageEl.text('✕ Las contraseñas no coinciden').show();
          return;
        }

        const submitBtn = $('#submit-btn');
        submitBtn.prop('disabled', true).text('Registrando...');

        $.ajax({
          url: 'backend/usuarios/register.php',
          method: 'POST',
          data: {
            nombre: nombre,
            email: email,
            password: password,
            rol: $('#rol').val()
          },
          dataType: 'json',
          success: function(response) {
            if (response.status === 'success') {
              messageEl.removeClass('error-message').addClass('success-message');
              messageEl.text('✓ Registro exitoso. Redirigiendo a login...').show();
              setTimeout(function() {
                window.location.href = 'login.html';
              }, 2000);
            } else {
              messageEl.removeClass('success-message').addClass('error-message');
              messageEl.text('✕ ' + (response.message || 'Error en el registro')).show();
              submitBtn.prop('disabled', false).text('Crear Cuenta');
            }
          },
          error: function() {
            messageEl.removeClass('success-message').addClass('error-message');
            messageEl.text('✕ Error en la solicitud').show();
            submitBtn.prop('disabled', false).text('Crear Cuenta');
          }
        });
      }

      // Limpiar mensaje al escribir
      $('#nombre, #email, #password, #password_confirm').on('keydown', function() {
        $('#message').hide();
      });
    </script>

</body>
</html>
